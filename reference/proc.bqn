h â† â€¢file.Chars "APL1.htm" # https://www.jsoftware.com/papers/APL1.htm

# Adapted from bqn-libs
lf â† @+10
Find â† âˆ§âŸœÂ«Ë=âŒœ  # â‰ âˆ˜âŠ¢â†‘â· is slow currently
ReplaceAll â† { âŸ¨old,newâŸ© ğ•Š str:
  ! (â‰ new) â‰¡ l â† â‰ old
  match â† 1-Ëœ (l+1)|âŒŠÂ´ (â†•âŠ¸-l) Ã— old FindÂ¨ <str
  cont â† (-âŸœ1âŒˆâ‰¤âŸœ1Ã—âŠ¢)` match âŠ (â‰ Â¨old)âˆ¾0
  keep â† â‹ˆâŸœ(âŠâŸœstr) / 0=cont
  insert â† (newâŠËœâŠâŸœmatch)âŠ¸(â‰ Â¨âŠ¸/â‹ˆâˆ¾âˆ˜âŠ£) / (0âŠ¸<âˆ§Â»âŠ¸â‰¤) cont
  â‹âŠ¸âŠÂ´ keep âˆ¾Â¨ insert
}

h (@+13)âŠ¸â‰ âŠ¸/â†©
lc â† (âˆ¨Â´FindâŸœhÂ¨"<i>"â€¿"<b>"â€¿"<tt>"â€¿"<nobr>")âˆ¨'<'â‰ h  # If line can continue paragraph
h +â†© (' '-lf) Ã— ((Â»âˆ¨Â«)âŠ¸<lf=h) âˆ§ Â«lc

# List &chars that appear
#â€¢Show âˆ¨âŒ¾(âŒ½Ë˜) (â·â‰Ë˜/â¼âˆ˜âŠ) (7âŒŠâ‰ )âŠ¸â†‘Â¨ h âŠ”Ëœ (1-Ëœ>Ã—âŠâˆ˜âŠ£)â—‹(âŒˆ`âŠ¢Ã—1+â†•âˆ˜â‰ )Ë "&;"=âŒœh

greek â† âŸ¨"Î±alpha","Î²beta","Î³gamma","Î“Gamma","Î´delta","Ïµepsilon","Î¸theta"
         "Î»lambda","Î¼mu","Î½nu","Ï†phi","Î¦Phi","Ïƒsigma","Ï„tau","Ï€pi"âŸ©
apl â† "â³âˆŠâ´âµâº" â‹ˆâ—‹â‹ˆÂ¨ "Î¹ÏµÏÏ‰Î±"

chars â† ("&"âˆ¾âˆ¾âŸœ";")âŒ¾âŠ‘Â¨ (â‹ˆâŸœ("\"âŠ¸âˆ¾)Â¨1â†“Â¨greek) âˆ¾ âŸ¨
  "nbsp"  â€¿" "
  "larr"  â€¿"â†"
  "rarr"  â€¿"â†’"
  "harr"  â€¿"\leftrightarrow"
  "darr"  â€¿"â†“"
  "uarr"  â€¿"â†‘"
  "#133"  â€¿"..."
  "ndash" â€¿"-"
  "times" â€¿"\times"
  "ldquo" â€¿"``"
  "rdquo" â€¿"''"
  "int"   â€¿"\int"
  "ne"    â€¿"\neq"
  "and"   â€¿"\wedge"
  "or"    â€¿"\vee"
  "gt"    â€¿">"
  "lt"    â€¿"<"
  "le"    â€¿"\leq"
  "ge"    â€¿"\geq"
  "rceil" â€¿"âŒ‰"
  "rfloor"â€¿"âŒ‹"
  "#8971" â€¿"\rfloor"
  "prime" â€¿"'"
  "Prime" â€¿"'"
  "#149"  â€¿"â€¢"
  "middot"â€¿"\cdot"
  "sube"  â€¿"\subseteq"
  "supe"  â€¿"\supseteq"
  "rsquo" â€¿"'"
  "mdash" â€¿"---"
  "sup2"  â€¿"^2"
  "sup3"  â€¿"^3"
  "notin" â€¿"\notin"
  "uuml"  â€¿"Ã¼"
  "equiv" â€¿"\equiv"
âŸ©

repl â† chars âˆ¾ apl âˆ¾ âŸ¨
  "\"     â€¿"\backslash"
  "&times"â€¿"\times"
  "&mu"   â€¿"\mu"
  " sin " â€¿" \sin "
  "<br>"  â€¿("\\"âˆ¾lf)
  "<p align=center>"â€¿"\par "
  "<p>"   â€¿"\par ",    "</p>"    â€¿""
  "<b><i>"â€¿"\vect{",   "</i></b>"â€¿"}"
  "<i>"   â€¿"\textit{", "</i>"    â€¿"}"
  "<b>"   â€¿"\textbf{", "</b>"    â€¿"}"
  "<sub>" â€¿"_{",       "</sub>"  â€¿"}"
  "<sup>" â€¿"^{",       "</sup>"  â€¿"}"
  "<tt>"  â€¿"",         "</tt>"   â€¿""
  "<nobr>"â€¿"",         "</nobr>" â€¿""
  "<table>"â€¿"\begin{tabularx}", "</table>"â€¿"\end{tabularx}"
  "<tr>"  â€¿"",         "</tr>"   â€¿"\\"
  "<td>"  â€¿"",         "</td>"   â€¿" & "
  "<font face=""Script"">R</font>"â€¿"\mathcal{R}"
  "<font face=Script>R</font>"â€¿"\mathcal{R}"
  "<font face=""Arial"">"â€¿"\mathsf{"
  "<font face=Arial>"â€¿"\mathsf{"
  "<font size=+1>"â€¿"\large{", "<font size=-1>"â€¿"\small{"
  "</font>"â€¿"}"
  "<img src=""APLimg/alphaboscore.bmp"">"               â€¿"\overbar{\vect{\alpha}}"
  "<img src=""APLimg/omegaboscore.bmp"">"               â€¿"\overbar{\vect{\omega}}"
  "<img src=""APLimg/uoscore.bmp"">"                    â€¿"\overbar{u}"
  "<img src=""APLimg/xoscore.bmp"">"                    â€¿"\overbar{x}"
  "<img src=""APLimg/fboscore.bmp"">"                   â€¿"\overbar{\vect{f}}"
  "<img src=""APLimg/uboscore.bmp"">"                   â€¿"\overbar{\vect{u}}"
  "<img src=""APLimg/vboscore.bmp"">"                   â€¿"\overbar{\vect{v}}"
  "<img src=""APLimg/epsboscore.bmp"">"                 â€¿"\overbar{\textbf{Ïµ}}"
  "<img src=""APLimg/ecapboscore.bmp"">"                â€¿"\overbar{\mathsf{\mat{E}}}"
  "<img src=""APLimg/uarr.bmp"">"                       â€¿"\Uparrow"
  "<img src=""APLimg/circleplus.bmp"">"                 â€¿"\oplus"
  "<img src=""APLimg/circledot.bmp"">"                  â€¿"\odot"
  "<img src=""APLimg/plustimes.bmp"">"                  â€¿"{+ \atop \times}"
  "<img src=""APLimg/timesslash.bmp"">"                 â€¿"{\times \atop /}"
  "<img src=""APLimg/orand.bmp"">"                      â€¿"{\vee \atop \wedge}"
  "<img src=""APLimg/circle1circle2.bmp"">"             â€¿"{\odot_1 \atop \odot_2}"
  "<img align=middle src=""APLimg/circle1circle2.bmp"">"â€¿"{\odot_1 \atop \odot_2}"
  "<img src=""APLimg/jotcircle.bmp"">"                  â€¿"{\circ \atop \odot_2}"
  "<img src=""APLimg/jottimes.bmp"">"                   â€¿"{\circ \atop \times}"
  "<img src=""APLimg/jotand.bmp"">"                     â€¿"{\circ \atop \wedge}"
  "<img src=""APLimg/jotbase.bmp"">"                    â€¿"{\circ \atop âŠ¥}"
âŸ©
repl âˆ¾Ëœâ†© âŸ¨ "<sup><i>&nbsp;"â€¿"^{\textit{", "<sub><i>&nbsp;"â€¿"_{\textit{" âŸ©

h â†© " }"â€¿"}" â‹ˆÂ¨âŠ¸ReplaceAll (<Ë˜â‰>repl) ReplaceAll h
h (Â»âŠ¸âˆ¨' 'âŠ¸â‰ )âŠ¸/â†©
h (1 (("\"âˆ¾â†“)Â¨â‹ˆâ†‘Â¨) greek)âŠ¸ReplaceAllâ†©

# Split into lines
l â† (âŠ¢-Ëœ+`Ã—Â¬)âˆ˜=âŸœlfâŠ¸âŠ” h
l (âˆ¨Â´Â¬âˆ˜âˆŠâŸœ" \&")âŠ¸/Â¨â†©
l /Ëœâ†© Â»âŠ¸âˆ¨ 0<â‰ Â¨l

Math â† {
  p â† ğ•©âˆŠ".,;:"
  s â† ğ•©=' '
  m â† 0âŒ¾âŠ‘(ğ•©='\')âˆ¨((@+128)â‰¤ğ•©)âˆ¨(ğ•©âˆŠ"}"âˆ¾âˆ¾"0aA"+âŸœâ†•Â¨10â€¿26â€¿26)<(Â»âˆ§Â«)' '=ğ•©
  iâ€¿b â† âˆ¨`FindâŸœğ•©Â¨ "\textbf{"â‹ˆËœtiâ†"\textit{"
  m >â†© b
  m âˆ¨â†© i â†© i âˆ§ (1+â‰ ti)â¥ŠâŸœ0âŠ¸Â«Â«âŠ¸âˆ¨'}'=ğ•©
  PFâ† +`âˆ˜âŠ£âŠ1(Â¬âˆ¾/âˆ¾Ëœ)(âˆ¨/âŠ£)  # Fill partitions ğ•¨ based on ğ•©
  e â† ((pâˆ§1âŠ¸Â«)âŠ¸âˆ¨s) (>âŸœ(Â»âˆ§Â«)<âŠ¢) s PF m
  f â† Â¬ (â‰ `(0Â¨ti)âŠ¸Â»âŠ¸âˆ¨i) âˆ¨ (â‰ ğ•©)â†‘/â¼('}'â‰ âŠâŸœğ•©)âŠ¸+(1+â‰ ti)+/iâˆ§â†©e
  (âˆ¾âŸœ(/f) â‹âŠ¸âŠ '$'Â¨âˆ¾(f/ğ•©)Ë™) /0(âˆ¾â‰ âˆ¾Ëœ)e
}âŸ(0<â‰ )
l MathâŸ("$"âŠ¸(âŠ‘Â¬âˆ˜âˆŠ)âˆ§("<a "â‰¡3âŠ¸â†‘)âˆ¨"\par"â‰¡4âŠ¸â†‘)Â¨â†©

Combs â† <Ë˜âˆ˜â‰{âˆ¾"\"â€¿ğ•¨â€¿"{"â€¿ğ•©â€¿"}"}âŒœ
post â† ("$"âŠ¸(âˆ¾Ëœâ‹ˆâˆ¾)Â¨ "th"â€¿"-origin"â€¿"-index"â€¿"-residue"â€¿"-reduction") âˆ¾ âŸ¨
  "\mathsf{\textbf{E}}"â€¿"\mat{E}"
  "//"â€¿"/\!/"
âŸ© âˆ¾ (âˆ¾"mat"â€¿"mathbf"â€¿"tree" "textbf"âŠ¸â‹ˆâŠ¸CombsÂ¨âŸ¨'A'+â†•26,"Î±Î»Î¼Î½Ï€Ï","Î¦Î“"âŸ©)âˆ¾("vect"â€¿"mat"Combs'A'+â†•26)
SimpSub â† (Â¬Â·Â»âŸ2âŠ¸âˆ¨âˆŠâŸœ"^_"Â»âŠ¸âˆ§'{'âŠ¸=âˆ§Â·Â«âŸ2'}'âŠ¸=)âŠ¸/

"APL1.tex" â€¢file.Chars SimpSub (<Ë˜â‰>post) ReplaceAll âˆ¾âˆ¾âŸœlfÂ¨ l
